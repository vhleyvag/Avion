<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoja de Cálculo y Gráficas Interactivas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            overflow: hidden; /* Evita el scroll global del body */
        }
        body {
            display: flex;
            flex-direction: column;
        }
        h1 {
            text-align: center;
            padding: 15px;
            background-color: #333;
            color: white;
            margin: 0 0 10px 0;
            flex-shrink: 0;
        }
        .main-container {
            display: flex;
            flex-grow: 1;
            padding: 0 10px 10px 10px;
            gap: 10px;
            overflow: hidden;
            /* position: relative; Eliminado ya que no hay resizer */
        }
        .left-section, .right-section {
            background-color: white;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Asegura que el contenido interno maneje su propio scroll */
            flex: 1; /* Ambas secciones ocupan el espacio equitativamente */
        }

        /* Redimensionador - Estilos eliminados */

        /* Sección Izquierda (Hoja de Cálculo) */
        .left-section h2 {
            margin-top: 0;
            flex-shrink: 0;
        }
        .table-container {
            flex-grow: 1;
            overflow: auto; /* Habilita el scroll vertical y horizontal SOLO para esta tabla */
            position: relative; /* Para sticky headers */
            border: 1px solid #ccc; /* Borde para el contenedor del scroll */
        }

        /* Sección Derecha (Gráfica) */
        .right-section h2 {
            text-align: center;
            margin-top: 0;
            font-size: 1.2em;
            color: #333;
            flex-shrink: 0;
        }
        #chart-controls {
            flex-shrink: 0;
            margin-bottom: 10px;
            text-align: center;
        }
        #chart-controls label {
            margin-right: 15px;
            font-weight: bold;
        }
        #chart-container {
            position: relative;
            width: 100%;
            max-height: 700px; /* Límite de altura para el contenedor de la gráfica */
            flex-grow: 1;
            min-height: 300px;
        }

        /* Estilos de la tabla */
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 0.85em;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: left;
            word-wrap: break-word;
            white-space: nowrap; /* Evita que el texto se rompa en varias líneas */
        }
        th.row-header {
            background-color: #e9e9e9;
            font-weight: bold;
            text-align: center;
            position: sticky;
            left: 0;
            z-index: 1;
        }
        thead th.col-header {
            background-color: #e0e0e0;
            font-weight: bold;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 2;
        }
        thead th.corner-cell { /* Esquina superior izquierda fija */
            position: sticky;
            top: 0;
            left: 0;
            z-index: 3;
            background-color: #d0d0d0;
        }

        /* Colores de celdas personalizados */
        #cell-A1, #cell-A2 { background-color: #FFC599; }
        #input-B1, #input-B2 { background-color: #FFE1CC; }
        #cell-B4 { background-color: #C9A6E4; }
        .data-b-cell { background-color: #EDE2F6; } /* Para B5:B249 */
        #cell-C4, #label-D1 { background-color: #B889DB; }
        #cell-E1 { background-color: #DCC5ED; } /* E1 específico */
        .data-c-cell { background-color: #DCC5ED !important; } /* C5:C249, !important para sobrescribir output-cell */
        #cell-D4 { background-color: #B6D7A8; }
        .data-d-cell { background-color: #D9EAD3 !important; } /* D5:D249, !important para sobrescribir output-cell */
        #cell-E4 { background-color: #B3CEFB; }
        .data-e-cell { background-color: #D9E7FD !important; } /* E5:E249, !important para sobrescribir output-cell */


        td.label {
            background-color: #f0f0f0; /* Default para labels si no tienen otro color */
            font-weight: bold;
        }
        input[type="number"] {
            width: 95%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
            font-size: 1em;
            text-align: right;
        }
        .output-cell, .input-data-cell {
            font-family: monospace;
            text-align: right;
        }
        /* Eliminamos el color de fondo general de .output-cell para que los nuevos colores tengan efecto */
        /* .output-cell { background-color: #e0f7fa; } */ 
        .editable-yellow {
            background-color: #fff9c4; /* Color amarillo para celdas editables */
        }
        td[contenteditable="true"]:focus {
            outline: 2px solid #007bff;
            background-color: white;
        }
    </style>
</head>
<body>
    <h1>Hoja de Cálculo y Gráficas Interactivas</h1>
    <div class="main-container">
        <div class="left-section">
            <h2>Datos y Cálculos</h2>
            <div class="table-container">
                <table id="spreadsheet">
                    <colgroup>
                        <col style="width: 35px;">  <!-- Números de fila -->
                        <col style="width: 120px;"> <!-- A -->
                        <col style="width: 100px;"> <!-- B -->
                        <col style="width: 100px;"> <!-- C -->
                        <col style="width: 100px;"> <!-- D -->
                        <col style="width: 100px;"> <!-- E -->
                    </colgroup>
                    <thead>
                        <tr>
                            <th class="corner-cell"></th> <!-- Celda esquina -->
                            <th class="col-header">A</th>
                            <th class="col-header">B</th>
                            <th class="col-header">C</th>
                            <th class="col-header">D</th>
                            <th class="col-header">E</th>
                        </tr>
                    </thead>
                    <tbody id="spreadsheet-body">
                        <!-- Fila 1 -->
                        <tr>
                            <th class="row-header">1</th>
                            <td class="label" id="cell-A1">v<sub>x0</sub> [m/s]</td>
                            <td><input type="number" id="input-B1" step="0.01" value="0.00"></td>
                            <td class="editable-yellow" id="cell-C1"></td>
                            <td class="label" id="label-D1">a<sub>x</sub> [m/s<sup>2</sup>]</td>
                            <td class="output-cell" id="cell-E1"></td>
                        </tr>
                        <!-- Fila 2 -->
                        <tr>
                            <th class="row-header">2</th>
                            <td class="label" id="cell-A2">x<sub>0</sub> [m]</td>
                            <td><input type="number" id="input-B2" step="0.01" value="0.00"></td>
                            <td class="editable-yellow" id="cell-C2"></td>
                            <td class="editable-yellow" id="cell-D2"></td>
                            <td class="editable-yellow" id="cell-E2"></td>
                        </tr>
                        <!-- Fila 3 (Vacía) -->
                        <tr>
                            <th class="row-header">3</th>
                            <td class="editable-yellow" id="cell-A3"></td>
                            <td class="editable-yellow" id="cell-B3"></td>
                            <td class="editable-yellow" id="cell-C3"></td>
                            <td class="editable-yellow" id="cell-D3"></td>
                            <td class="editable-yellow" id="cell-E3"></td>
                        </tr>
                        <!-- Fila 4 (Títulos) -->
                        <tr>
                            <th class="row-header">4</th>
                            <td class="label" id="label-A4">t [s]</td>
                            <td class="label" id="cell-B4">a [m/s<sup>2</sup>]</td>
                            <td class="label" id="cell-C4">a<sub>x</sub> [m/s<sup>2</sup>]</td>
                            <td class="label" id="cell-D4">v<sub>x</sub> [m/s]</td>
                            <td class="label" id="cell-E4">x [m]</td>
                        </tr>
                        <!-- Filas de datos (A5 a E249) se generarán con JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- <div class="resizer"></div> El resizer ha sido eliminado -->

        <div class="right-section">
            <h2>Visualización de Gráfica</h2>
            <div id="chart-controls">
                <label><input type="radio" name="chartType" value="a_vs_t" checked> a vs t</label>
                <label><input type="radio" name="chartType" value="ax_vs_t"> a<sub>x</sub> vs t</label>
                <label><input type="radio" name="chartType" value="vx_vs_t"> v<sub>x</sub> vs t</label>
                <label><input type="radio" name="chartType" value="x_vs_t"> x vs t</label>
            </div>
            <div id="chart-container">
                <canvas id="myChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const tbody = document.getElementById('spreadsheet-body');
        const inputVx0 = document.getElementById('input-B1');
        const inputD0 = document.getElementById('input-B2');
        const cellE1 = document.getElementById('cell-E1');
        const chartCanvas = document.getElementById('myChart');
        const chartControls = document.getElementById('chart-controls');
        // const leftSection = document.querySelector('.left-section'); Eliminado
        // const resizer = document.querySelector('.resizer'); Eliminado
        // const mainContainer = document.querySelector('.main-container'); Eliminado

        const totalHeaderRows = 4; // Ahora hay 4 filas de encabezado/inputs (1, 2, 3 vacía, 4 títulos)
        const numDataRows = 245; // De A5 a A249 sigue siendo 245 filas de datos

        let myChart = null;
        let accelerationData = []; // Para almacenar los datos de aceleracion.csv

        // Cargar datos de aceleracion.csv
        const csvData = `3.654
3.787
3.908
4.044
4.096
4.149
4.305
4.347
4.388
4.473
4.507
4.532
4.584
4.538
4.529
4.634
4.62
4.547
4.567
4.644
4.621
4.613
4.634
4.643
4.654
4.64
4.619
4.616
4.659
4.639
4.608
4.596
4.689
4.727
4.666
4.63
4.626
4.688
4.647
4.628
4.661
4.639
4.613
4.678
4.651
4.654
4.634
4.681
4.773
4.719
4.717
4.706
4.7
4.65
4.605
4.654
4.686
4.636
4.629
4.673
4.671
4.676
4.661
4.582
4.567
4.583
4.596
4.598
4.593
4.616
4.655
4.558
4.561
4.554
4.516
4.453
4.52
4.598
4.599
4.563
4.602
4.577
4.529
4.521
4.532
4.52
4.585
4.56
4.552
4.577
4.563
4.549
4.55
4.534
4.535
4.496
4.517
4.491
4.585
4.566
4.525
4.494
4.56
4.589
4.523
4.525
4.597
4.482
4.451
4.494
4.497
4.507
4.574
4.511
4.499
4.493
4.418
4.442
4.444
4.468
4.556
4.556
4.533
4.581
4.483
4.439
4.431
4.448
4.445
4.417
4.455
4.562
4.444
4.465
4.473
4.403
4.404
4.392
4.438
4.452
4.439
4.449
4.397
4.35
4.369
4.475
4.456
4.439
4.482
4.466
4.326
4.368
4.448
4.426
4.352
4.399
4.496
4.412
4.35
4.265
4.316
4.387
4.372
4.361
4.359
4.251
4.223
4.277
4.313
4.39
4.337
4.377
4.314
4.302
4.381
4.289
4.288
4.353
4.447
4.471
4.378
4.335
4.35
4.298
4.215
4.193
4.354
4.273
4.324
4.363
4.324
4.298
4.23
4.179
4.182
4.276
4.357
4.294
4.277
4.209
4.268
4.335
4.257
4.25
4.237
4.353
4.274
4.222
4.366
4.32
4.08
4.144
4.245
4.357
4.378
4.324
4.248
4.098
4.103
4.215
4.212
4.276
4.36
4.326
4.148
4.042
4.109
4.17
4.287
4.227
4.245
4.176
4.093
4.159
4.158
4.121
4.202
4.158
4.159
4.273
4.167
4.137
4.054
4.074
4.076`;
        accelerationData = csvData.split('\n').map(s => parseFloat(s.trim()));

        // Colores para las gráficas - ACTUALIZADOS
        const colors = {
            a: '#7030A0', // Puntos para a vs t
            ax: '#7030A0', // Línea para ax vs t
            vx: '#548235', // Línea para vx vs t
            x: '#4472C4' // Línea para x vs t
        };

        const chartConfigs = {
            a_vs_t: {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'a [m/s²]',
                        data: [],
                        borderColor: colors.a,
                        backgroundColor: colors.a, // El color del punto será sólido
                        showLine: false, // NO MOSTRAR LÍNEA
                        tension: 0.1,
                        pointRadius: 3, // ligeramente más grande para los puntos
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 't [s]' } },
                        y: { title: { display: true, text: 'a [m/s²]' }, beginAtZero: false }
                    },
                    plugins: { legend: { position: 'top' }, title: { display: false } }
                }
            },
            ax_vs_t: {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'aₓ [m/s²]',
                        data: [],
                        borderColor: colors.ax,
                        backgroundColor: colors.ax + '50', // 50% opacity para el área debajo de la línea
                        fill: false,
                        tension: 0.1,
                        pointRadius: 2,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 't [s]' } },
                        y: { title: { display: true, text: 'aₓ [m/s²]' }, beginAtZero: false }
                    },
                    plugins: { legend: { position: 'top' }, title: { display: false } }
                }
            },
            vx_vs_t: {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'vₓ [m/s]',
                        data: [],
                        borderColor: colors.vx,
                        backgroundColor: colors.vx + '50',
                        fill: false,
                        tension: 0.1,
                        pointRadius: 2,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 't [s]' } },
                        y: { title: { display: true, text: 'vₓ [m/s]' }, beginAtZero: true }
                    },
                    plugins: { legend: { position: 'top' }, title: { display: false } }
                }
            },
            x_vs_t: {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'x [m]',
                        data: [],
                        borderColor: colors.x,
                        backgroundColor: colors.x + '50',
                        fill: false,
                        tension: 0.1,
                        pointRadius: 2,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', position: 'bottom', title: { display: true, text: 't [s]' } },
                        y: { title: { display: true, text: 'x [m]' }, beginAtZero: true }
                    },
                    plugins: { legend: { position: 'top' }, title: { display: false } }
                }
            }
        };

        function calculateAverageAcceleration() {
            if (accelerationData.length === 0) return 0;
            const sum = accelerationData.reduce((acc, val) => acc + val, 0);
            return sum / accelerationData.length;
        }

        function actualizarCalculosFilasYGrafica() {
            const vx0_val = parseFloat(inputVx0.value) || 0.0;
            const d0_val = parseFloat(inputD0.value) || 0.0;
            const avg_ax = calculateAverageAcceleration();
            cellE1.textContent = avg_ax.toFixed(3); // Actualiza E1

            const data_a_vs_t = [];
            const data_ax_vs_t = [];
            const data_vx_vs_t = [];
            const data_x_vs_t = [];

            for (let i = 0; i < numDataRows; i++) {
                // Las filas de datos comienzan en la fila 5, que es totalHeaderRows + 1
                const currentRowNumber = totalHeaderRows + 1 + i;
                const cellT_element = document.getElementById(`cell-A${currentRowNumber}`);
                const cellA_element = document.getElementById(`cell-B${currentRowNumber}`);
                const cellAx_element = document.getElementById(`cell-C${currentRowNumber}`);
                const cellVx_element = document.getElementById(`cell-D${currentRowNumber}`);
                const cellX_element = document.getElementById(`cell-E${currentRowNumber}`);

                const time = parseFloat(cellT_element.textContent);
                const acceleration_val = parseFloat(cellA_element.textContent);

                // Celda C (a_x)
                cellAx_element.textContent = avg_ax.toFixed(3);

                // Celda D (v_x)
                const vx_calc = vx0_val + avg_ax * time;
                cellVx_element.textContent = vx_calc.toFixed(3);

                // Celda E (x)
                const x_calc = d0_val + vx0_val * time + 0.5 * avg_ax * Math.pow(time, 2);
                cellX_element.textContent = x_calc.toFixed(4);

                // Preparar datos para las gráficas
                if (!isNaN(time) && !isNaN(acceleration_val)) {
                    data_a_vs_t.push({ x: time, y: acceleration_val });
                }
                if (!isNaN(time) && !isNaN(avg_ax)) {
                    data_ax_vs_t.push({ x: time, y: avg_ax });
                }
                if (!isNaN(time) && !isNaN(vx_calc)) {
                    data_vx_vs_t.push({ x: time, y: vx_calc });
                }
                if (!isNaN(time) && !isNaN(x_calc)) {
                    data_x_vs_t.push({ x: time, y: x_calc });
                }
            }

            // Actualizar datos en las configuraciones de las gráficas
            chartConfigs.a_vs_t.data.datasets[0].data = data_a_vs_t;
            chartConfigs.ax_vs_t.data.datasets[0].data = data_ax_vs_t;
            chartConfigs.vx_vs_t.data.datasets[0].data = data_vx_vs_t;
            chartConfigs.x_vs_t.data.datasets[0].data = data_x_vs_t;

            updateChart(); // Llama a la función para redibujar la gráfica actual
        }

        function generarEstructuraTabla() {
            for (let i = 0; i < numDataRows; i++) {
                const time = i * 0.076;
                const currentRowNumber = totalHeaderRows + 1 + i; // Fila 5 en adelante

                const row = document.createElement('tr');
                const thRowNum = document.createElement('th');
                thRowNum.className = 'row-header';
                thRowNum.textContent = currentRowNumber;
                row.appendChild(thRowNum);

                // Celda A (Tiempo)
                const tdT = document.createElement('td');
                tdT.id = `cell-A${currentRowNumber}`;
                tdT.className = 'input-data-cell';
                tdT.textContent = time.toFixed(3);
                row.appendChild(tdT);

                // Celda B (Aceleración de CSV)
                const tdA = document.createElement('td');
                tdA.id = `cell-B${currentRowNumber}`;
                tdA.className = 'input-data-cell data-b-cell';
                tdA.textContent = accelerationData[i] ? accelerationData[i].toFixed(3) : 'N/A';
                row.appendChild(tdA);

                // Celda C (a_x promedio)
                const tdAx = document.createElement('td');
                tdAx.id = `cell-C${currentRowNumber}`;
                tdAx.className = 'output-cell data-c-cell'; // Se asegura de que tenga la clase de color
                row.appendChild(tdAx);

                // Celda D (v_x)
                const tdVx = document.createElement('td');
                tdVx.id = `cell-D${currentRowNumber}`;
                tdVx.className = 'output-cell data-d-cell'; // Se asegura de que tenga la clase de color
                row.appendChild(tdVx);

                // Celda E (x)
                const tdX = document.createElement('td');
                tdX.id = `cell-E${currentRowNumber}`;
                tdX.className = 'output-cell data-e-cell'; // Se asegura de que tenga la clase de color
                row.appendChild(tdX);

                tbody.appendChild(row);
            }
        }

        function updateChart() {
            const selectedChartType = document.querySelector('input[name="chartType"]:checked').value;
            const config = chartConfigs[selectedChartType];

            if (myChart) {
                myChart.destroy();
            }
            myChart = new Chart(chartCanvas.getContext('2d'), config);
        }

        // Event listeners para los inputs de B1 y B2
        inputVx0.addEventListener('input', actualizarCalculosFilasYGrafica);
        inputD0.addEventListener('input', actualizarCalculosFilasYGrafica);

        // Event listeners para los radio buttons
        chartControls.addEventListener('change', updateChart);

        // Inicialización
        window.addEventListener('load', () => {
            generarEstructuraTabla();
            actualizarCalculosFilasYGrafica(); // Realiza los cálculos iniciales y dibuja la primera gráfica
        });
    </script>

</body>
</html>